<div class="background wrapper">
	<button mat-fab color="primary" class="fixed-top-right mat-elevation-z5" (click)="create()">
		<mat-icon>add</mat-icon>
	</button>
	<mat-tab-group [selectedIndex]="currTabIndex" (selectedIndexChange)="onTabChange($event)">
		<mat-tab label="{{ 'tools' | translate }}"></mat-tab>
		<mat-tab label="{{ 'bases' | translate }}"></mat-tab>
		<mat-tab label="{{ 'mts' | translate }}"></mat-tab>
		<mat-tab label="{{ 'wps' | translate }}"></mat-tab>
	</mat-tab-group>
	<div class="table-wrapper">
		<as-split direction="horizontal">
			<as-split-area size="30">
				<mat-table
					#table
					[dataSource]="dataSource"
					matSort
					matSortActive="name"
					matSortDirection="asc"
					matSortDisableClear
					class="data-table mat-elevation-z3">
					<ng-container matColumnDef="select">
						<mat-header-cell *matHeaderCellDef class="dont-flex">
							<mat-checkbox
								color="primary"
								(change)="$event ? masterToggle() : null"
								[checked]="selection.hasValue() && isAllSelected()"
								[indeterminate]="selection.hasValue() && !isAllSelected()"
                [disabled]="dataSource.data.length === 1"
							>
							</mat-checkbox>
						</mat-header-cell>
						<mat-cell *matCellDef="let row" class="dont-flex">
							<mat-checkbox
								color="primary"
								(click)="$event.stopPropagation()"
								(change)="$event ? selection.toggle(row) : null"
								[checked]="selection.isSelected(row)"
								[disabled]="row.name === 'VOID'"
							>
							</mat-checkbox>
						</mat-cell>
					</ng-container>
					<ng-container matColumnDef="name">
						<mat-header-cell *matHeaderCellDef mat-sort-header="name">{{ 'name' | translate }}</mat-header-cell>
						<mat-cell *matCellDef="let element">
							<div class="name-wrap">{{ element.name }}<span *ngIf="element.isArr"> [...]</span></div>
						</mat-cell>
					</ng-container>
					<ng-container matColumnDef="arrIndex">
						<mat-header-cell *matHeaderCellDef>{{ 'index' | translate }}</mat-header-cell>
						<mat-cell *matCellDef="let element">
							<mat-form-field *ngIf="element.isArr" style="min-width: 0;">
								<mat-select
									placeholder="{{ 'index' | translate }}"
									[(ngModel)]="element.selectedIndex"
									(selectionChange)="rowClick(element, true)"
								>
									<mat-option *ngFor="let data of element.value; let i = index" [value]="i + 1">{{ i + 1 }}</mat-option>
								</mat-select>
							</mat-form-field>
						</mat-cell>
					</ng-container>
					<mat-header-row *matHeaderRowDef="['select', 'name']"></mat-header-row>
					<mat-row
						*matRowDef="let row; columns: ['select', 'name']; let element"
						(click)="rowClick(element)"
						[class.highlighted]="selectedVar && element.name === selectedVar.name"
						[class.current]="isElementCurrent(element.name)"
					></mat-row>
				</mat-table>
			</as-split-area>
			<as-split-area size="70">
				<div class="behind" *ngIf="!selectedVar && selection.selected.length === 0">
					<img src="assets/pics/{{currFrameType}}.svg">
					<h3>{{ 'frames.none' | translate:frameTypeTranslated }}</h3>
					<img src="assets/pics/Curved_Arrow.svg" class="arrow invert">
				</div>
        <div class="external-buttons" *ngIf="selection.selected.length > 0">
          <button mat-raised-button color="warn" (click)="deleteChecked()">
            {{ 'button.delete_selected' | translate }}
          </button>
        </div>
				<mat-card class="mat-elevation-z3 data-card" *ngIf="selectedVar || selection.selected.length > 0">
					<div class="var-name" *ngIf="selectedVar">
						{{ selectedVar.name }}{{ selectedVar.isArr ? '[' + selectedVar.selectedIndex + ']' : '' }}
					</div>
					<div class="buttons">
						<button
							*ngIf="selectedVar && selectedVar.name !== 'VOID'"
							mat-raised-button
							color="primary"
							(click)="showCalibrationDialog()"
							[disabled]="busy"
						>
							{{ 'button.calibrate' | translate }}
						</button>
						<button *ngIf="selectedVar" mat-raised-button color="primary" (click)="setAsCurrent()" [disabled]="busy">
							{{ 'button.set_current' | translate }}
						</button>
						<button
							*ngIf="selectedVar && selectedVar.name !== 'VOID'"
							mat-raised-button
							color="warn"
							[disabled]="busy || isElementCurrent(selectedVar.name)"
							(click)="deleteSelected()"
						>
							{{ 'dataScreen.del' | translate: selectedVar }}
						</button>
					</div>
					<div class="var-details" *ngIf="selectedVar">
						<!-- <mat-form-field *ngFor="let val of _value; let i = index" floatLabel="never">
							<span matPrefix style="font-weight: bold;">{{ this._legend[i] }}:&nbsp;&nbsp;</span>
							<input
								matInput
								[placeholder]="_legend[i]"
								[(ngModel)]="_value[i].value"
								(change)="onKeyboardClose()"
								virtualKeyboard
								ktype="numeric"
								[disabled]="selectedVar.name === 'VOID' || busy"
								(onKeyboardClose)="onKeyboardClose()"
							/>
                        </mat-form-field> -->
                        <custom-key-board *ngFor="let val of _value; let i = index" type="float"
                            prefix="{{ this._legend[i] }}:&nbsp;&nbsp;" [placeHolder]="_legend[i]" [(value)]="_value[i].value"
                            (valueChange)="onKeyboardClose()" [disabled]="selectedVar.name === 'VOID' || busy"
                            (blurEvent)="onKeyboardClose()"
                        ></custom-key-board>
					</div>
				</mat-card>
			</as-split-area>
		</as-split>
	</div>
</div>
