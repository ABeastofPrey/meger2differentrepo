<div class="wrapper" [class.tablet-ui]="cmn.isTablet">
	<program-toolbar tourAnchor="project-toolbar-1" *ngIf="!login.isViewer && !service.wizardMode"></program-toolbar>
	<div class="blocker" *ngIf="prj.isLoading"></div>
  <div *ngIf="prj.isLoading" class="center-block">
		<img src="assets/pics/{{ env.platform.spinner }}" />
	</div>
	<as-split direction="horizontal" (dragEnd)="onDragEnd()" unit="pixel" (gutterDblClick)="toggleGutter($event.gutterNum)" useTransition="true" [gutterDblClickDuration]="500">
		<as-split-area [size]="showGutterLeft ? '210' : '0'" maxSize="400">
			<program-editor-side-menu class="mat-elevation-z1"></program-editor-side-menu>
		</as-split-area>
		<as-split-area>
			<as-split direction="vertical" (dragEnd)="onDragEnd()">
				<as-split-area size="70" class="right-side" style="position: relative;">
					<router-outlet></router-outlet>
				</as-split-area>
				<as-split-area
					size="30"
					[minSize]="10"
					*ngIf="service.mode === 'editor'"
				>
					<as-split direction="horizontal" (dragEnd)="onDragEnd()" unit="pixel">
						<as-split-area>
							<div class="err-container compact-tabs">
								<mat-tab-group	[selectedIndex]="selectedTab" (selectedIndexChange)="onTabChange($event)" *ngIf="!cmn.isTablet" animationDuration="0ms">
									<mat-tab>
										<ng-template mat-tab-label>
											<div>{{'projects.notification.title' | translate}}</div>
											<div class="badge primary-bg">{{ service.errors.length }}</div>
										</ng-template>
									</mat-tab>
									<mat-tab [disabled]="notification.windowOpen">
										<ng-template mat-tab-label>
											<div>{{'message_log' | translate}}</div>
											<div class="badge primary-bg">{{ notification.count | async }}</div>
										</ng-template>
									</mat-tab>
									<mat-tab *ngIf="login.isAdmin" label="{{'terminal' | translate}}"></mat-tab>
								</mat-tab-group>
								<div *ngIf="selectedTab === 0" class="tab-content">
									<div *ngIf="!service.backtrace && service.errors.length > 0">
										<span style="font-weight: 500;">{{service.errors.length}}</span>
										{{ 'projects.notification.errMsg' | translate }}
										<div
											*ngFor="let e of service.errors"
											class="center-vertical error-line"
											(click)="e.number === -1 ? null : service.skipToLine(e.number)"
											[class.error-line-selectable]="e.number !== -1"
											[class.warning-line] = "e.type === 'warning'"
										>
											<mat-icon style="margin-right: 8px;">{{ e.type !== 'warning' ? 'bug_report' : 'warning' }}</mat-icon>
											<span *ngIf="e.file && service.activeFilePath + service.activeFile !== e.file">{{e.file}} |&nbsp;</span>
											<span *ngIf="e.number !== -1">Line {{ e.number + ':' }}&nbsp;&nbsp;</span>
											<span *ngIf="e.number === -1">Task {{ e.file + ':' }}&nbsp;&nbsp;</span>
											<span>{{ e.error }}</span>
										</div>
									</div>
									<div *ngIf="service.errors.length === 0 && !service.backtrace">
										{{ 'projects.notification.none' | translate }}
									</div>
									<div *ngIf="service.backtrace && service.errors.length === 0" class="backtrace">
										<div>Backtrace:</div>
										<div *ngFor="let file of service.backtrace.files">
											{{ file.name }}(<a
												(click)="onLinkClick(file)"
												>{{ file.path }}{{ file.name }}:{{ file.line }}</a
											>)
										</div>
									</div>
									<div *ngIf="service.backtrace && service.errors.length > 0" class="backtrace err">
										{{ 'projects.notification.exception' | translate:{task: '"' + service.backtrace.files[service.backtrace.files.length - 1].name + '"'} }}: <b>{{ service.errors[0].error }}</b>
										<div *ngFor="let file of service.backtrace.files" class="bt-line">
											{{ 'projects.notification.at' | translate }} {{ file.name }}(<a
												matRipple
												matRippleUnbounded="false"
												(click)="login.isAdmin && onLinkClick(file)"
												[class.disabled]="!login.isAdmin"
												>{{ file.path }}{{ file.name }}:{{ file.line }}</a
											>)
										</div>
									</div>
								</div>
								<message-log *ngIf="selectedTab === 1" class="tab-content"></message-log>
								<terminal *ngIf="selectedTab === 2" class="tab-content"></terminal>
							</div>
						</as-split-area>
						<as-split-area size="200" minSize="200">
							<coordinates></coordinates>
						</as-split-area>
					</as-split>
				</as-split-area>
			</as-split>
		</as-split-area>
		<as-split-area
			[size]="showGutterRight ? '170' : '0'"
			*ngIf="service.mode === 'editor' && !login.isOperator && !login.isViewer"
		>
			<program-edit-menu class="mat-elevation-z1"></program-edit-menu>
		</as-split-area>
	</as-split>
</div>
